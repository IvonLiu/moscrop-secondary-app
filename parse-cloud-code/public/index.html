<html>

    <head>
        <title>Moscrop Secondary</title>

        <!--Import materialize.css-->
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <!-- Import Parse -->
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>
    </head>

    <body>
        <div id="loggedInActions">
            <a id="submitButton" class="waves-effect waves-light btn" href="submit.html">Submit</a>
            <a id="adminButton" class="waves-effect waves-light btn" href="administration.html">Administration</a>
            <a id="logoutButton" class="waves-effect waves-light btn" onclick="logout()">Logout</a>
        </div>
        <div id="loggedOutActions">
            <a id="loginButton" class="waves-effect waves-light btn" href="login.html">Login</a>
            <a id="registerButton" class="waves-effect waves-light btn" href="register.html">Register</a>
        </div>

        <script>
            Parse.initialize("TtFxol5uKm6piqaomYYvaTtezhRJQFZFRadc9qit", "smiduKJqXsJXvEnYj5nUSBFxxTXMpHiZZibVVyLx");
            var currentUser = Parse.User.current();

            var divLoggedInActions = document.getElementById("loggedInActions");
            var divLoggedOutActions = document.getElementById("loggedOutActions");

            if (currentUser) {
                // do stuff with the user
                divLoggedOutActions.style.display = "none";

                // get user permissions
                if (currentUser.getUsername() != "Superuser") {
                    var query = new Parse.Query(Parse.Role);
                    query.containedIn("name", ["administrator", "moderator"]);
                    query.equalTo("users", Parse.User.current());
                    query.first().then(function(privilegedRole) {
                        if (!privilegedRole) {                            
                            var adminButton = document.getElementById("adminButton");
                            adminButton.style.display = "none";
                            query.equalTo("name", "contributor");
                            query.first().then(function(contributorRole) {
                                if (!contributorRole) {
                                    var submitButton = document.getElementById("submitButton");
                                    submitButton.style.display = "none";
                                }
                            });
                        }
                    });
                }
            } else {
                // show the signup or login page
                divLoggedInActions.style.display = "none";
            }

            /*function showSubmitPage() {
                window.location.href = "submit.html";
            }

            function showAdminPage() {
                window.location.href = "administration.html";
            }*/

            function logout() {
                Parse.User.logOut();
                currentUser = Parse.User.current();  // this will now be null
                location.reload();
            }

            /*function showLoginPage() {
                window.location.href = "login.html";
            }

            function showRegisterPage() {
                window.location.href = "register.html";
            }*/

        </script>

        <!--Import jQuery before materialize.js-->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/materialize.js"></script>
    </body>
</html>